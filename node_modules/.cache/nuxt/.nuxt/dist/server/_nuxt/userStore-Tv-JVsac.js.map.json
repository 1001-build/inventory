{"file":"userStore-Tv-JVsac.js","mappings":"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","names":[],"sources":["../../../../../../../app/composables/useErrorHandler.ts","../../../../../../../app/composables/useSubdomain.ts","../../../../../../../app/composables/useExtendedFetch.js","../../../../../../../app/stores/userStore.js"],"sourcesContent":["// ========================================\n// FRONTEND ERROR HANDLER\n// ========================================\n// Centralized error handling for API responses\n// Imports error codes from backend for type-safe error handling\n// Uses i18n for multi-language error messages\n// ========================================\n\nimport { ERROR_CODES, type ErrorCode } from \"#shared/error/codes\";\nimport type { FetchError } from \"ofetch\";\n\ninterface ApiErrorData {\n  message?: string;\n  error?: {\n    code?: string;\n    message?: string;\n    traceID?: string;\n  };\n}\n\ninterface ErrorHandlerOptions {\n  blockRedirect?: boolean;\n  customMessage?: string;\n  onError?: (code: ErrorCode | \"UNKNOWN_ERROR\") => void;\n}\n\ninterface ErrorMessage {\n  title: string;\n  description: string;\n  action?: {\n    label: string;\n    onClick: () => boolean;\n  };\n  shouldRedirect?: boolean;\n  redirectTo?: string;\n}\n\n/**\n * Map error codes to redirect configurations\n */\nconst redirectConfig: Partial<Record<ErrorCode, { path: string }>> = {\n  [ERROR_CODES.AUTH_REQUIRED]: { path: \"/auth/signin\" },\n  [ERROR_CODES.INVALID_TOKEN]: { path: \"/auth/signin\" },\n  [ERROR_CODES.TOKEN_EXPIRED]: { path: \"/auth/signin\" },\n  [ERROR_CODES.TENANT_MISMATCH]: { path: \"/auth/signin\" },\n};\n\n/**\n * Map error codes to action button configurations\n */\nconst actionConfig: Partial<Record<ErrorCode, { path: string }>> = {\n  [ERROR_CODES.EMAIL_NOT_CONFIRMED]: { path: \"/auth/email/resend\" },\n  [ERROR_CODES.ACCOUNT_INACTIVE]: { path: \"/support\" },\n  [ERROR_CODES.EMAIL_EXISTS]: { path: \"/auth/signin\" },\n  [ERROR_CODES.INTERNAL_ERROR]: { path: \"/support\" },\n  [ERROR_CODES.DATABASE_ERROR]: { path: \"/support\" },\n};\n\n/**\n * Get error message from i18n translations\n * This function can be called outside of setup context\n */\nfunction getErrorMessage(code: ErrorCode | \"UNKNOWN_ERROR\"): ErrorMessage {\n  const { t } = useI18n();\n  const errorKey = `errors.${code}`;\n\n  // Build error message from i18n\n  const message: ErrorMessage = {\n    title: t(`${errorKey}.title`),\n    description: t(`${errorKey}.description`),\n  };\n\n  // Add redirect configuration if exists\n  const redirect = redirectConfig[code as ErrorCode];\n  if (redirect) {\n    message.shouldRedirect = true;\n    message.redirectTo = redirect.path;\n  }\n\n  // Add action button if translation exists\n  const actionPath = actionConfig[code as ErrorCode];\n  if (actionPath && t(`${errorKey}.action.label`)) {\n    message.action = {\n      label: t(`${errorKey}.action.label`),\n      onClick: () => {\n        navigateTo(actionPath.path);\n        return true;\n      },\n    };\n  }\n\n  return message;\n}\n\n/**\n * Handle API errors with appropriate user feedback\n * This is a standalone function that can be called from anywhere\n *\n * @param error - The fetch error from the API\n * @param options - Additional options for error handling\n */\nexport function handleApiError(\n  error: FetchError<ApiErrorData>,\n  options: ErrorHandlerOptions = {}\n) {\n  const config = useRuntimeConfig();\n  const isDebugMode = config.public.debugMode;\n  const showToast = useShowToast();\n  const { blockRedirect = false, customMessage, onError } = options;\n\n  // Extract error details\n  const status = error.response?.status || 500;\n  const errorData = error.response?._data;\n  const code = (errorData?.error?.code || \"UNKNOWN_ERROR\") as\n    | ErrorCode\n    | \"UNKNOWN_ERROR\";\n  const serverMessage = errorData?.error?.message;\n  const traceID = errorData?.error?.traceID;\n\n  // Debug logging\n  if (isDebugMode) {\n    console.error(\"API Error:\", {\n      status,\n      code,\n      serverMessage,\n      traceID,\n      rawError: error,\n    });\n  }\n\n  // Get error message configuration from i18n\n  const errorConfig = getErrorMessage(code);\n\n  // Show toast notification\n  showToast({\n    title: errorConfig.title,\n    description: customMessage || errorConfig.description,\n    action: errorConfig.action,\n  });\n\n  // Handle redirects (unless blocked)\n  if (\n    !blockRedirect &&\n    errorConfig.shouldRedirect &&\n    errorConfig.redirectTo\n  ) {\n    navigateTo(errorConfig.redirectTo);\n  }\n\n  // Call custom error handler if provided\n  if (onError) {\n    onError(code);\n  }\n\n  // Return error details for further handling if needed\n  return {\n    code,\n    status,\n    message: serverMessage || errorConfig.description,\n    traceID,\n  };\n}\n\n/**\n * Centralized error handler for API errors with i18n support\n * Use this composable in setup context for type-safe error utilities\n *\n * @example\n * const { handleApiError } = useErrorHandler()\n *\n * try {\n *   await $fetch('/api/v1/users')\n * } catch (error) {\n *   handleApiError(error)\n * }\n */\nexport function useErrorHandler() {\n\n  /**\n   * Check if an error code requires authentication\n   */\n  function isAuthError(code: ErrorCode | \"UNKNOWN_ERROR\"): boolean {\n    const authErrors: ErrorCode[] = [\n      ERROR_CODES.AUTH_REQUIRED,\n      ERROR_CODES.INVALID_TOKEN,\n      ERROR_CODES.TOKEN_EXPIRED,\n      ERROR_CODES.TENANT_MISMATCH,\n    ];\n    return authErrors.includes(code as ErrorCode);\n  }\n\n  /**\n   * Check if an error code is a validation error\n   */\n  function isValidationError(code: ErrorCode | \"UNKNOWN_ERROR\"): boolean {\n    const validationErrors: ErrorCode[] = [\n      ERROR_CODES.VALIDATION_ERROR,\n      ERROR_CODES.INVALID_INPUT,\n      ERROR_CODES.MISSING_FIELD,\n      ERROR_CODES.INVALID_EMAIL_FORMAT,\n    ];\n\n    return (\n      validationErrors.includes(code as ErrorCode) ||\n      code.startsWith(\"PASSWORD_\")\n    );\n  }\n\n  return {\n    handleApiError, // Re-export the standalone function for convenience\n    isAuthError,\n    isValidationError,\n    ERROR_CODES, // Export error codes for use in components\n  };\n}\n","// /client/composables/useSubdomain.ts\n\n/**\n ** A composable that extracts the subdomain from host.\n ** Works both on the server and client side (window.location vs request headers).\n ** Returns the subdomain as a string if present, or null if not.\n **/\nexport function useSubdomain(): string | null {\n  // Determine the full host (with optional port)\n  const host = import.meta.server\n    ? useRequestEvent()?.node?.req?.headers.host ?? \"\"\n    : window.location.host;\n\n  // Strip off port if present\n  const hostname = host.split(\":\")[0];\n  // Split into domain segments\n  const parts = hostname.split(\".\");\n\n  // Return the subdomain string (or null)\n  return parts.length > 2 ? parts[0] : null;\n}\n","// composables/useExtendedFetch.js\nimport { handleApiError } from \"./useErrorHandler\";\n\n/**\n ** A composable for making API requests with extended functionality.\n ** It includes request ID and tenant ID headers and centralized error handling.\n ** Authentication is handled automatically by nuxt-auth-utils via session cookies.\n ** It also provides a simple fetch that does not handle errors.\n * @module useExtendedFetch\n * @requires handleApiError - For centralized error handling\n * @requires useSubdomain - For tenant identification\n * @requires useRuntimeConfig - For accessing runtime configuration like API URL\n **/\nexport function useExtendedFetch() {\n  const baseUrl = useRuntimeConfig().public.apiUrl;\n\n  /**\n   ** A simple $fetch wrapper that includes request ID and tenant ID headers.\n   ** It does ***NOT*** handler errors.\n   * @param {string} path - The API endpoint to fetch\n   * @param {Object} [options={}] - Optional fetch options like method, body, etc.\n   * @returns {Promise<Object>} - Returns an object with status and payload\n   * @throws {Error} - Throws an error if the fetch fails\n   **/\n  async function simpleFetch(path, options = {}) {\n    const requestId = crypto.randomUUID();\n    const subdomain = useSubdomain();\n\n    const headers = {\n      \"Content-Type\": \"application/json\",\n      \"X-Request-Id\": requestId,\n      \"X-Tenant-Id\": subdomain,\n      ...options.headers,\n    };\n\n    const res = await $fetch.raw(path, {\n      ...options,\n      baseURL: baseUrl,\n      credentials: \"include\",\n      headers,\n    });\n    return { status: res.status, ok: res.ok, payload: res._data };\n  }\n\n  /**\n   ** A wrapper around simpleFetch, includes everything from simpleFetch.\n   ** Additionally provides centralized error handling.\n   ** Authentication is handled automatically via nuxt-auth-utils session cookies.\n   * @param {string} path - The API endpoint to fetch\n   * @param {Object} [options={}] - Optional fetch options like method, body, etc.\n   * @param {boolean} [blockRedirect=false] - If true, prevents redirecting on 401/403 errors\n   **/\n  async function extendedFetch(\n    path,\n    options = {},\n    blockRedirect = false\n  ) {\n    try {\n      return await simpleFetch(path, options);\n    } catch (error) {\n      /////////////////////////////////////////////////////////////////////\n      // Central Error Handler\n      /////////////////////////////////////////////////////////////////////\n      handleApiError(error, { blockRedirect });\n    }\n  }\n\n  return { simpleFetch, extendedFetch };\n}\n","import { defineStore } from \"pinia\";\nimport posthog from \"posthog-js\";\n\nexport const useUserStore = defineStore(\"user-store\", {\n  state: () => ({\n    // Local UI state\n    // theme preference: 'light' | 'dark'\n    theme: 'light',\n\n    // User profile data from session\n    userProfile: null,\n\n    isLoading: false,\n    error: null,\n  }),\n  getters: {},\n  actions: {\n    async signin({ email, password, redirectTo = \"/\" } = {}) {\n      this.isLoading = true;\n      const showToast = useShowToast();\n      const { extendedFetch } = useExtendedFetch();\n      const { fetch: fetchSession } = useUserSession();\n\n      const { status, payload } = await extendedFetch(\"/v1/auth/signin\", {\n        method: \"POST\",\n        body: {\n          email,\n          password,\n        },\n      });\n\n      if (status === 200) {\n        // Fetch the session from nuxt-auth-utils\n        await fetchSession();\n\n        showToast({\n          title: \"Success\",\n          description: \"You are now logged in.\",\n        });\n\n        // Track user login\n        posthog.identify(payload.data.user.email, {\n          user_id: payload.data.user.id,\n          email: payload.data.user.email,\n          first_name: payload.data.user.firstName,\n          last_name: payload.data.user.lastName,\n        });\n\n        this.isLoading = false;\n        return navigateTo(redirectTo);\n      } else {\n        this.isLoading = false;\n        return false;\n      }\n    },\n\n    async signup({ firstName, lastName, email, password, passwordConfirmation } = {}) {\n      this.isLoading = true;\n      const showToast = useShowToast();\n      const { extendedFetch } = useExtendedFetch();\n\n      const { status } = await extendedFetch(\"/v1/auth/signup\", {\n        method: \"POST\",\n        body: {\n          firstName,\n          lastName,\n          email,\n          password,\n          passwordConfirmation,\n        },\n      });\n\n      if (status === 200 || status === 201) {\n        showToast({\n          title: \"Account Created\",\n          description: \"Please check your email to verify your account before signing in.\",\n        });\n\n        // Track user signup\n        posthog.capture('user_signed_up', {\n          email: email,\n        });\n\n        this.isLoading = false;\n        return navigateTo('/auth/signin');\n      } else {\n        this.isLoading = false;\n        return false;\n      }\n    },\n\n    setTheme(theme) {\n      const allowed = ['light', 'dark']\n      if (!allowed.includes(theme)) return\n      this.theme = theme\n    },\n\n    async fetchUserProfile() {\n      const { extendedFetch } = useExtendedFetch();\n\n      try {\n        const { status, payload } = await extendedFetch(\"/v1/user/profile\", {\n          method: \"GET\",\n        });\n\n        if (status === 200) {\n          this.userProfile = payload.data;\n        }\n      } catch (error) {\n        console.error('Failed to fetch user profile:', error);\n        this.userProfile = null;\n      }\n    },\n\n    async signout({ redirectTo = \"/auth/signin\" } = {}) {\n      this.isLoading = true;\n      const showToast = useShowToast();\n      const { clear } = useUserSession();\n\n      // Call signout endpoint\n      const { extendedFetch } = useExtendedFetch();\n      await extendedFetch(\"/v1/auth/signout\", {\n        method: \"POST\",\n      });\n\n      // Clear session on client\n      await clear();\n\n      // Clear user profile\n      this.userProfile = null;\n\n      // Track user logout\n      posthog.reset();\n\n      // Do not clear theme on signout so app preference remains\n      this.isLoading = false;\n      this.error = null;\n\n      showToast({\n        title: \"Success\",\n        description: \"You have signed out.\",\n      });\n\n      return navigateTo(redirectTo);\n    },\n\n    async requestPasswordReset({ email } = {}) {\n      this.isLoading = true;\n      const showToast = useShowToast();\n      const { extendedFetch } = useExtendedFetch();\n\n      const { status } = await extendedFetch(\"/v1/auth/password/reset/request\", {\n        method: \"POST\",\n        body: {\n          email,\n        },\n      });\n\n      if (status === 200) {\n        showToast({\n          title: \"Reset Email Sent\",\n          description: \"Please check your email for password reset instructions.\",\n        });\n\n        this.isLoading = false;\n        return navigateTo('/auth/signin');\n      } else {\n        this.isLoading = false;\n        return false;\n      }\n    },\n\n    async resetPassword({ token, newPassword, newPasswordConfirmation } = {}) {\n      this.isLoading = true;\n      const showToast = useShowToast();\n      const { extendedFetch } = useExtendedFetch();\n\n      const { status } = await extendedFetch(\"/v1/auth/password/reset\", {\n        method: \"PUT\",\n        body: {\n          token,\n          newPassword,\n          newPasswordConfirmation,\n        },\n      });\n\n      if (status === 200) {\n        showToast({\n          title: \"Password Reset Successfully\",\n          description: \"You can now sign in with your new password.\",\n        });\n\n        this.isLoading = false;\n        return navigateTo('/auth/signin');\n      } else {\n        this.isLoading = false;\n        return false;\n      }\n    },\n  },\n  persist: {\n    omit: [\"isLoading\", \"error\", \"userProfile\"],\n  },\n});\n"],"version":3}